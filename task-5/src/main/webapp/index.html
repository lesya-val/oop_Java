<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Список студентов</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body class="container px-3">
<h1>Список студентов</h1>
<table class="table">
    <thead>
    <tr>
        <th scope="col">Имя</th>
        <th scope="col">Фамилия</th>
        <th scope="col">Группа</th>
        <th scope="col">Возраст</th>
        <th scope="col">Изучаемый предмет</th>
        <th scope="col">Действия</th>
    </tr>
    </thead>
    <tbody id="students">
    </tbody>
</table>
<h2>Добавить студента</h2>
<form class="form-group" id="add-student-form">
    <label>Имя:</label>
    <input class="form-control" type="text" name="name" required><br>
    <label>Фамилия:</label>
    <input class="form-control" type="text" name="surname" required><br>
    <label>Группа:</label>
    <input class="form-control" type="text" name="groupName" required><br>
    <label>Возраст:</label>
    <input class="form-control" type="number" name="age" required><br>
    <label>Изучаемый предмет:</label>
    <input class="form-control" type="text" name="subject" required><br>
    <button class="btn btn-primary" type="submit">Добавить</button>
</form>

<script>
    const studentsTable = document.getElementById('students');
    const addStudentForm = document.getElementById('add-student-form');

    function loadStudents() {
        fetch('/students')
            .then(response => {
                if (!response.ok) {
                    throw new Error("Ошибка HTTP " + response.status);
                }
                return response.json();
            })
            .then(students => {
                studentsTable.innerHTML = '';
                students.forEach(student => {
                    const row = document.createElement('tr');
                    row.innerHTML =
                        `<td>${student.name}</td>
                    <td>${student.surname}</td>
                    <td>${student.groupName}</td>
                    <td>${student.age}</td>
                    <td>${student.subject}</td>
                    <td>
                        <button class="btn btn-primary" onclick="editStudent(${student.id})">Редактировать</button>
                        <button class="btn btn-danger" onclick="deleteStudent(${student.id})">Удалить</button>
                    </td>`
                    studentsTable.appendChild(row);
                });
            })
            .catch(error => console.error(error));
    }
    loadStudents();

    addStudentForm.addEventListener('submit', event => {
        event.preventDefault();
        const formData = new FormData(addStudentForm);
        const student = {
            name: formData.get('name'),
            surname: formData.get('surname'),
            groupName: formData.get('groupName'),
            age: formData.get('age'),
            subject: formData.get('subject')
        };
        fetch('/students', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(student)
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error("Ошибка HTTP " + response.status);
                }
                return response.json();
            })
            .then(() => {
                addStudentForm.reset();
                loadStudents();
            })
            .catch(error => console.error(error));
    });

    function editStudent(id) {
        const name = prompt('Введите новое имя:');
        const surname = prompt('Введите новую фамилию:');
        const groupName = prompt('Введите новую группу:');
        const age = prompt('Введите новый возраст:');
        const subject = prompt('Введите новый изучаемый предмет:');
        const student = {
            id: id,
            name: name,
            surname: surname,
            groupName: groupName,
            age: age,
            subject: subject
        };
        fetch('/students', {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(student)
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error("Ошибка HTTP " + response.status);
                }
                return response.json();
            })
            .then(() => {
                loadStudents();
            })
            .catch(error => console.error(error));
    }

    function deleteStudent(id) {
        if (confirm('Вы уверены, что хотите удалить этого студента?')) {
            fetch(`/students?id=${id}`, {
                method: 'DELETE'
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Ошибка HTTP " + response.status);
                    }
                    return response.json();
                })
                .then(() => {
                    loadStudents();
                })
                .catch(error => console.error(error));
        }
    }
</script>
